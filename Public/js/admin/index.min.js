function loadMenuContent(key,name,url){$("#myTab").find(".active").eq(0).removeClass("active");$("#myTabContent").find(".active").eq(0).removeClass("in").removeClass("active");if($("#tab_"+key).length>0){activeSubTab(key)}else{addMenuTab(key,name,url);$("#appiframe_"+key).load(function(){$(this).height($(this).contents().height()>480 ? $(this).contents().height() : 480);$("#loading_"+key).hide();var targetUrl=this.contentWindow.location.href;if(targetUrl.indexOf("login")>-1){window.location=targetUrl}})}}function addMenuTab(key,name,url){var ftabs,pKey,prevTab;ftabs='<li id="tab_'+key+'" class="active"><a data-toggle="tab" href="#tabContent_'+key+'"><input type="hidden" id="targetUrl_'+key+'" name="targetUrl" value="'+url+'"/>'+name+'<i class="icon-remove small-90" name="close_menu" onclick="closeMenuContent(\''+key+'\')"></i></a></li>';var tabContent='<div id="tabContent_'+key+'" class="tab-pane page-content in active"><p id="loading_'+key+'"><img src="/Public/img/loading.gif"></p><iframe id="appiframe_'+key+'" src="'+url+'" style="width:100%;height:100%;" frameborder="0" scrolling="no"></iframe></div>';$("#myTab").append(ftabs);$("#myTabContent").append(tabContent);var myTabWidth=$("#myTab").width();var totalWidth=0;for(var i=0;i<$("#myTab").find("li").length;i++){totalWidth+=parseInt($("#myTab").find("li").eq(i).width())}if(totalWidth>(myTabWidth-150)){if($("#tab_submores").length>0){prevTab=$("#tab_submores").prev()}else{prevTab=$("#tab_"+key).prev()}pKey=prevTab.attr("id").replace("tab_","");if($("#tab_"+pKey).attr("id")!=='tab_home'){reChangeTab(key,pKey)}}else if($("#tab_submores").length>0){prevTab=$("#tab_submores").prev();pKey=prevTab.attr("id").replace("tab_","");if($("#tab_"+pKey).attr("id")!=='tab_home'){reChangeTab(key,pKey)}}}function activeSubTab(key){var pKey;$("#myTab").find(".active").eq(0).removeClass("active");$("#myTabContent").find(".active").eq(0).removeClass("in").removeClass("active");if($("#tab_"+key).parents().attr("id")=='tab_submores_ul'){try{var totalWidth=0;for(var i=0;i<$("#myTab").find("li").length;i++){totalWidth+=parseInt($("#myTab").find("li").eq(i).width())}if($("#tab_"+key).width()>($("#myTab").width()-totalWidth-150)){pKey=$("#tab_submores").prev().attr("id").replace("tab_","");if($("#tab_"+pKey).attr("id")!=='tab_home'){reChangeTab(key,pKey)}else{showSubTab(key)}}else{showSubTab(key)}}catch(e){}}$("#tab_"+key).addClass("active");$("#tabContent_"+key).addClass("in").addClass("active")}function refreshMenuContent(){try{var current=$("#myTab").find(".active").eq(0);var currentKey=current.attr("id").replace("tab_","");var href=current.find("a").eq(0).attr("href");if(href!=='#tabContent_home'){$("#loading_"+currentKey).show();$("#appiframe_"+currentKey).attr("src",current.find("input").eq(0).val(),function(){$(this).height($(this).contents().height()>480 ? $(this).contents().height() : 480);$("#loading_"+currentKey).hide();var targetUrl=this.contentWindow.location.href;if(targetUrl.indexOf("login")>-1){window.location=targetUrl}})}}catch(e){}}function closeMenuContent(key){var currentWidth,current,activityTabKey;current=$("#tab_"+key);var currentTabWidth=current.width();var currentTabParentsId=current.parents().attr("id");if($("#myTab").find(".active").length>0){try{activityTabKey=$("#myTab").find(".active").eq(0).attr("id").replace("tab_","");if(current.prev()){var prevTabKey=current.prev().attr("id").replace("tab_","");if(activityTabKey==key){$("#tab_"+prevTabKey).addClass("active");$("#tabContent_"+prevTabKey).addClass("in").addClass("active")}}}catch(e){}}$("#tab_"+key).remove();$("#tabContent_"+key).remove();var moreTabNum=$("#tab_submores").find("ul").eq(0).find("li").length;if(currentTabParentsId!=='tab_submores_ul'&&moreTabNum>0){var myTabWidth=$("#myTab").width();var totalWidth=0;for(var i=0;i<$("#myTab").find("li").length;i++){totalWidth+=parseInt($("#myTab").find("li").eq(i).width())}var kWidth=myTabWidth-totalWidth+currentTabWidth-150;for(var j=0;j<moreTabNum;j++){if(kWidth<=0){break}currentWidth=$("#tab_submores").find("ul").eq(0).find("li").eq(j).width();if(currentWidth<=kWidth){try{showSubTab($("#tab_submores").find("ul").eq(0).find("li").eq(j).attr("id").replace("tab_",""))}catch(e){break}kWidth-=currentWidth}}}}function showSubTab(key){var obj=$("#tab_"+key);var targetHtml=obj.prop("outerHTML");if($("#tab_submores").find("ul").eq(0).find("li").length>0){obj.remove();$("#tab_submores").before(targetHtml)}else{obj.remove();$("#myTab").append(targetHtml)}$("#tab_"+key).find("a").eq(0).attr("href","#tabContent_"+key);$("#tab_"+key).find("a").eq(0).removeAttr("onclick");if($("#tab_"+key).find("a").eq(0).find("i").length<1){$("#tab_"+key).find("a").eq(0).append('<i onclick="closeMenuContent(\''+key+'\')" name="close_menu" class="icon-remove small-90"></i>')}if($("#tab_submores").find("ul").eq(0).find("li").length<1){$("#tab_submores").remove()}}function hideTabtoSubTab(key){var obj=$("#tab_"+key);var targetHtml=obj.prop("outerHTML");obj.remove();if($("#tab_submores").find("ul").eq(0).find("li").length>0){$("#tab_submores").find("ul").eq(0).append(targetHtml)}else{$("#myTab").append('<li id="tab_submores" class="dropdown"><a data-toggle="dropdown" class="dropdown-toggle" href="#">more \>\><b class="caret"></b></a><ul id="tab_submores_ul" class="dropdown-menu dropdown-info">'+targetHtml+'</ul></li>')}$("#tab_"+key).find("a").eq(0).attr("href","#");$("#tab_"+key).find("a").eq(0).attr("onclick","activeSubTab('"+key+"');");$("#tab_"+key).find("a").eq(0).find("i").remove()}function reChangeTab(key,targetKey){hideTabtoSubTab(targetKey);showSubTab(key)}function resizeTabs(newWidth,flag){var prevTab,pKey,prevTabHtml,pTab,tabs,moreTabNum,pHtml,currentWidth;var totalWidth=0;if(flag===1){moreTabNum=$("#tab_submores").find("ul").eq(0).find("li").length;if(moreTabNum>0){for(var i=0;i<$("#myTab").find("li").length;i++){totalWidth+=parseInt($("#myTab").find("li").eq(i).width())}var kWidth=newWidth-totalWidth-150;currentWidth=$("#tab_submores").find("ul").eq(0).find("li").eq(0).width();if(currentWidth<=kWidth){showSubTab($("#tab_submores").find("ul").eq(0).find("li").eq(0).attr("id").replace("tab_",""))}}}else{for(var i=0;i<$("#myTab").find("li").length;i++){totalWidth+=parseInt($("#myTab").find("li").eq(i).width())}while((totalWidth>(newWidth-150))){try{if($("#tab_submores").find("ul").eq(0).find("li").length>0){prevTab=$("#tab_submores").prev()}else{prevTab=$("#myTab").find("li").eq($("#myTab").find("li").length-1)}if(prevTab==undefined||prevTab==''){break}if(prevTab.attr("id")==$("#myTab").find(".active").eq(0).attr("id")){prevTab=prevTab.prev()}if(prevTab.attr("id")=='tab_home'){break}pKey=prevTab.attr("id").replace("tab_","");hideTabtoSubTab(pKey);totalWidth=0;for(var i=0;i<$("#myTab").find("li").length;i++){totalWidth+=parseInt($("#myTab").find("li").eq(i).width())}}catch(e){break}}}}$(document).ready(function(){myTabWidth=$("#myTab").width();$(window).resize(function(){var newWidth=$("#myTab").width();if(newWidth>0){var flag=newWidth-myTabWidth;if(flag>0){resizeTabs(newWidth,1)}else if(flag<0){resizeTabs(newWidth,2)}myTabWidth=newWidth}})});